import csv
from parsel import Selector
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from bs4 import BeautifulSoup as bs 
from time import sleep


class Linkedin_Connexion :
    def __init__(self, path: str, identifiant: str, password: str):
        self.path=path
        self.identifiant=identifiant
        self.password=password
        driver = webdriver.Chrome(self.path)
        #get the linkedin url
        driver.get('https://www.linkedin.com/')

        #send your identifiant into the login zone
        username_input = driver.find_element_by_name('session_key')
        username_input.send_keys(self.identifiant)

        #send your password into the password zone
        password_input = driver.find_element_by_name('session_password')
        password_input.send_keys(self.password)
    
        # click on the sign in button
        # we're finding Sign in text button as it seems this element is seldom to be changed
        driver.find_element_by_class_name('sign-in-form__submit-button').click()


class Linkedin_Addnote : 
    # visit each profile in linkedin and grab detail we want to get
    def __init__(self, links): ### you need to get your links before, I will add the method to do it later
        self.links=links
        for link in self.links:
            driver.get(link)
            sleep(1.5)

            try:
                #find name:
                name = sel.xpath('//title/text()')
                #Add a Note
                driver.find_element_by_xpath("//button[text() = 'Connect']").click()
                sleep(1.5)
                driver.find_element_by_xpath("//span[text()='Add a note']").click()
                sleep(1.5)

                message = "Bonjour" + name.strip().split(' ')[0] + ",\n\nJe suis chargé d'études pour la French Tech Toulouse. J'ai ajouté ta startup dans notre base de données, est-ce que ça te dirait de compléter sa fiche ? Voici le lien : lien \nCes informations permettront de te proposer comme solution à nos partenaires business et de parler de toi à nos financeurs\nBonne journée!"

                driver.find_element_by_xpath("//textarea").send_keys(message)
                sleep(1.5)
        
                driver.find_element_by_xpath("//span[text()='Done']").click()
                sleep(1.5)

                driver.find_element_by_xpath("//input[@type = 'text']").clear()
                sleep(1.5)
        
            except:
                pass
    
driver.quit()
    
